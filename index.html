<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Hệ thống Báo cáo Ngành Kiểm sát</title>
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        /* Giao diện theo phong cách file index.html của bạn */
        body {
            font-family: 'Segoe UI', 'Times New Roman', sans-serif;
            margin: 0; padding: 0; background: #f0f2f5;
            display: flex; flex-direction: column; align-items: center;
        }
        header {
            width: 100%; padding: 15px; background-color: #0408c5;
            color: white; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        #login-container {
            background-color: #E6F7FF; padding: 35px; border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); max-width: 380px; width: 90%;
            margin-top: 100px; text-align: center;
        }
        #login-container h2 { color: #D32F2F; margin-bottom: 25px; }
        input, select, textarea { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
        
        /* Menu Navbar */
        .navbar { background: #0408c5; color: white; padding: 10px 20px; display: flex; justify-content: space-between; width: 100%; box-sizing: border-box; }
        .nav-links a { color: white; text-decoration: none; font-weight: bold; margin-left: 15px; cursor: pointer; padding: 5px 10px; }
        .nav-links a:hover { background: rgba(255,255,255,0.2); border-radius: 4px; }
        
        .main-app { max-width: 1000px; width: 95%; margin: 20px auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 0 15px rgba(0,0,0,0.1); }
        textarea { height: 500px; font-family: "Times New Roman", serif; font-size: 16px; line-height: 1.6; }
        .hidden { display: none; }
        .btn-action { background-color: #0408c5; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        
        /* Style cho bảng quản lý tài khoản */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #E6F7FF; color: #0408c5; }
    </style>
</head>
<body>

<header>
    <h1>VIỆN KIỂM SÁT NHÂN DÂN THÀNH PHỐ CẦN THƠ</h1>
    <h3>HỆ THỐNG QUẢN LÝ & TỔNG HỢP BÁO CÁO</h3>
</header>

<div id="login-screen">
    <div id="login-container">
        <img src="https://vienkiemsat.cantho.gov.vn/files/images/logo-vks.png" width="80" style="margin-bottom: 15px;">
        <h2>Đăng Nhập</h2>
        <input type="text" id="username" placeholder="Tên đăng nhập">
        <input type="password" id="password" placeholder="Mật khẩu">
        <button onclick="login()" class="btn-action" style="width: 100%;">Đăng nhập</button>
    </div>
</div>

<div id="app-screen" class="hidden" style="width: 100%;">
    <div class="navbar">
        <div id="user-tag">Đơn vị: ...</div>
        <div class="nav-links">
            <a onclick="showTab('tab-report')">Nhập báo cáo</a>
            <a id="admin-link" class="hidden" onclick="showTab('tab-admin')">Quản lý tài khoản</a>
            <a onclick="showTab('tab-pass')">Đổi mật khẩu</a>
            <a onclick="location.reload()" style="background: #D32F2F;">Đăng xuất</a>
        </div>
    </div>

    <div class="main-app">
        <div id="tab-report">
            <h2 style="color: #D32F2F;">NỘI DUNG BÁO CÁO CHI TIẾT</h2>
            <label>Chọn Mẫu báo cáo (Nội dung sẽ tự động hiển thị theo mẫu):</label>
            <select id="report-sel" onchange="loadTemplate()">
                <option value="">-- Chọn loại báo cáo --</option>
                <option value="40">Mẫu 40: Báo cáo tháng (Hình sự, Dân sự, THA, Khiếu nại...)</option>
                <option value="41">Mẫu 41: Báo cáo Sơ kết / Tổng kết năm</option>
                <option value="42">Mẫu 42: Báo cáo Vi phạm pháp luật trong hoạt động tư pháp</option>
            </select>
            <textarea id="report-text" placeholder="Vui lòng chọn mẫu báo cáo để hiển thị nội dung chi tiết..."></textarea>
            <button onclick="exportDoc()" class="btn-action">XUẤT BÁO CÁO FILE WORD (.DOCX)</button>
        </div>

        <div id="tab-admin" class="hidden">
            <h2 style="color: #D32F2F;">QUẢN TRỊ TÀI KHOẢN</h2>
            <div style="background: #f9f9f9; padding: 15px; border-radius: 5px;">
                <strong>Tạo tài khoản mới:</strong><br><br>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="new-u" placeholder="Tên đăng nhập">
                    <input type="text" id="new-n" placeholder="Tên đơn vị hiển thị">
                    <button onclick="addUser()" class="btn-action">Thêm mới</button>
                </div>
            </div>
            <table id="user-table">
                <thead><tr><th>Tài khoản</th><th>Tên đơn vị</th><th>Thao tác</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <div id="tab-pass" class="hidden">
            <h2>ĐỔI MẬT KHẨU</h2>
            <input type="password" id="old-p" placeholder="Mật khẩu cũ" style="max-width: 300px;"><br>
            <input type="password" id="new-p" placeholder="Mật khẩu mới" style="max-width: 300px;"><br>
            <button onclick="changePass()" class="btn-action">Cập nhật</button>
        </div>
    </div>
</div>

<script>
    // 1. NỘI DUNG CHI TIẾT THEO MẪU CỦA BẠN (TRÍCH TỪ FILE GỬI)
    const TEMPLATES = {
        "40": `BÁO CÁO THÁNG ... NĂM ...\n\nI. TÌNH HÌNH TỘI PHẠM\n1. Tội phạm xâm phạm an ninh quốc gia: ...\n2. Tội phạm về trật tự xã hội: ...\n3. Tội phạm về kinh tế, sở hữu, môi trường: ...\n4. Tội phạm về ma túy: ...\n5. Tội phạm về tham nhũng, chức vụ: ...\n6. Tội phạm xâm phạm hoạt động tư pháp: ...\n(Nêu khái quát tình hình, số vụ khởi tố mới, vụ việc điển hình...)\n\nII. KẾT QUẢ CÔNG TÁC KIỂM SÁT\n1. Kiểm sát việc giải quyết tố giác, tin báo tội phạm: ...\n2. Thực hành quyền công tố và kiểm sát điều tra: ...\n3. Thực hành quyền công tố và kiểm sát xét xử: ...\n4. Kiểm sát việc tạm giữ, tạm giam, thi hành án hình sự: ...\n5. Kiểm sát giải quyết vụ, việc dân sự, hôn nhân và gia đình: ...\n6. Kiểm sát giải quyết án hành chính, KDTM, lao động: ...\n7. Kiểm sát thi hành án dân sự, thi hành án hành chính: ...\n8. Kiểm sát giải quyết khiếu nại, tố cáo: ...\n\nIII. CÔNG TÁC XÂY DỰNG NGÀNH\n- Tổ chức cán bộ, thanh tra: ...\n- Quản lý, chỉ đạo điều hành: ...\n\nIV. KHÓ KHĂN, KIẾN NGHỊ: ...`,
        
        "41": `BÁO CÁO SƠ KẾT/TỔNG KẾT NĂM ...\n\nI. TÌNH HÌNH TỘI PHẠM, VI PHẠM PHÁP LUẬT\n1. Tình hình tội phạm (Khái quát chung, nguyên nhân): ...\n2. Tình hình tranh chấp dân sự, khiếu kiện hành chính: ...\n\nII. KẾT QUẢ THỰC HIỆN NHIỆM VỤ TRỌNG TÂM\n- Các chỉ tiêu theo Nghị quyết của Quốc hội: ...\n- Các nhiệm vụ trọng tâm của đơn vị: ...\n\nIII. KẾT QUẢ CÁC MẶT CÔNG TÁC KIỂM SÁT (Chi tiết 12 khâu công tác nghiệp vụ)\n...\n\nIV. ĐÁNH GIÁ CHUNG VÀ KIẾN NGHỊ\n1. Ưu điểm: ...\n2. Hạn chế, thiếu sót và nguyên nhân: ...\n3. Kiến nghị, đề xuất: ...\n\nV. NHIỆM VỤ TRỌNG TÂM THỜI GIAN TỚI: ...`,
        
        "42": `BÁO CÁO TÌNH HÌNH VI PHẠM PHÁP LUẬT TRONG HOẠT ĐỘNG TƯ PHÁP\n\nI. VI PHẠM PHÁP LUẬT TRONG HOẠT ĐỘNG TƯ PHÁP\n1. Trong hoạt động điều tra: (Việc thụ lý, giải quyết tin báo, khởi tố...): ...\n2. Trong hoạt động xét xử (Hình sự, Dân sự, Hành chính...): ...\n3. Trong hoạt động thi hành án (Hình sự, Dân sự): ...\n4. Trong hoạt động giải quyết khiếu nại, tố cáo tư pháp: ...\n\nII. ĐÁNH GIÁ VÀ NGUYÊN NHÂN\n1. Đánh giá hiệu quả hoạt động kiểm sát: ...\n2. Nguyên nhân dẫn đến vi phạm của các cơ quan tư pháp: ...\n\nIII. KIẾN NGHỊ ĐỀ XUẤT: ...`
    };

    // Quản lý dữ liệu người dùng
    let users = JSON.parse(localStorage.getItem('vks_data')) || [
        { u: 'admin', p: '123', n: 'Quản trị viên', r: 'admin' },
        { u: 'phong1', p: '123', n: 'Phòng 1', r: 'user' }
    ];
    let activeUser = null;

    // Lắng nghe phím Enter để đăng nhập
    document.addEventListener('keypress', function (e) {
        if (e.key === 'Enter' && !document.getElementById('login-screen').classList.contains('hidden')) {
            login();
        }
    });

    function login() {
        const u = document.getElementById('username').value;
        const p = document.getElementById('password').value;
        const acc = users.find(x => x.u === u && x.p === p);

        if (acc) {
            activeUser = acc;
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('app-screen').classList.remove('hidden');
            document.getElementById('user-tag').innerText = "Đơn vị: " + acc.n;
            if (acc.r === 'admin') document.getElementById('admin-link').classList.remove('hidden');
            renderUsers();
        } else {
            alert("Sai tài khoản hoặc mật khẩu!");
        }
    }

    function showTab(id) {
        ['tab-report', 'tab-admin', 'tab-pass'].forEach(t => document.getElementById(t).classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    function loadTemplate() {
        const val = document.getElementById('report-sel').value;
        document.getElementById('report-text').value = TEMPLATES[val] || "";
    }

    function renderUsers() {
        const tbody = document.querySelector('#user-table tbody');
        tbody.innerHTML = users.map(x => `
            <tr>
                <td>${x.u}</td>
                <td>${x.n}</td>
                <td><button onclick="resetPass('${x.u}')" style="font-size:11px;">Reset (123)</button></td>
            </tr>
        `).join('');
    }

    function addUser() {
        const u = document.getElementById('new-u').value;
        const n = document.getElementById('new-n').value;
        if (u && n) {
            users.push({ u, p: '123', n, r: 'user' });
            localStorage.setItem('vks_data', JSON.stringify(users));
            renderUsers();
            alert("Đã tạo!");
        }
    }

    function resetPass(u) {
        const i = users.findIndex(x => x.u === u);
        users[i].p = '123';
        localStorage.setItem('vks_data', JSON.stringify(users));
        alert("Xong!");
    }

    async function exportDoc() {
        const { Document, Packer, Paragraph, TextRun, AlignmentType } = docx;
        const content = document.getElementById('report-text').value;
        const doc = new Document({
            sections: [{
                children: [
                    new Paragraph({ children: [new TextRun({ text: "VIỆN KIỂM SÁT NHÂN DÂN TP CẦN THƠ", bold: true, size: 26 })], alignment: AlignmentType.CENTER }),
                    new Paragraph({ children: [new TextRun({ text: activeUser.n.toUpperCase(), bold: true, size: 26 })], alignment: AlignmentType.CENTER }),
                    new Paragraph({ text: "", spacing: { after: 300 } }),
                    ...content.split('\n').map(l => new Paragraph({
                        children: [new TextRun({ text: l, size: 28 })],
                        spacing: { line: 400 }
                    }))
                ],
            }],
        });
        Packer.toBlob(doc).then(blob => saveAs(blob, "Bao_cao_Kiem_sat.docx"));
    }
</script>
</body>
</html>
